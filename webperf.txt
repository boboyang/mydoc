IDC: 互联网数据中心,用来托管web服务器
IDC网管 通过对交换机限速，来控制链路层的流量，从而控制server带宽。


交换机、集线器(Hub)、路由器区别

集线器采用的式共享带宽的工作方式，而交换机是独享带宽。

 交换机是利用MAC地址来确定转发数据的目的地址。而路由器则是IP地址来确定数据转发的地址。
 路由器提供了防火墙的服务

cat /proc/loadavg
top, w 都是利用这个文件。 1,5,15 min 的cpu负载

Nmon 分析系统，生成曲线

IOWait: io time/ cpu time
查看： top命令， cpu: XX%wa 

进程的两种运行状态：用户态(cpu, memory)，内核态(IO, net)。

系统调用涉及用户态到内核态的切换（context，memory切换），所以开销比较昂贵。

1987年， Patterson、Gibson和Katz这三位工程师在加州大学伯克利分校发表了题为《A Case of Redundant Array of Inexpensive Disks(廉价磁盘冗余阵列方案)》的论文，其基本思想就是将多只容量较小的、相对廉价的硬盘驱动器进行有机组合，使其性能超过一只昂贵的大硬盘。

SATA的全称是Serial Advanced Technology Attachment（串行高级技术附件，一种基于行业标准的串行硬件驱动器接口）

memory mapping: 把内存的某块地址空间与磁盘文件相关联，从而更快地访问文件。

strace: trace system calls and signals.
Linux2.6之后，用户态和磁盘文件之间设置了内核缓冲区，使用了批量延迟写的策略。如果想直接读写磁盘，可以设置O_DIRECT参数。

Linux2.4之后，加入sendfile(), 可以将静态文件直接送到socket fd，从而提高了速度，减少cpu/内存开销。该方法不适合太小的文件。

epoll的优势在于：有大量非活跃的连接时。

第5章 动态脚本加速

opcode


脚本性能的跟踪与分析

让 PyPy 去生成 JIT 编译器

A profiler is a program that describes the run time performance of a program, providing a variety of statistics. 

第6章 浏览器缓存
ex：
chrome://view-http-cache/http://static.adzerk.net/Advertisers/879d9e1805a6495a9e3cbeeffe6da2ad.png

缓存协商
Last-Modified
Etag:  ---  If-None_Match:
md5(content) or more sophisticated

Expires:
完全放权给browser

F5 Ctrl+F5 return

Cache-Control: max-age=<second>
优先于Expires， 因为它使用相对时间，避免client时间与server不一致。

第7章 Web服务器缓存

缓存响应内容： disk/memory

缓存fd，针对大量小文件（静态内容），减少open()的%

第8章 Reverse Proxy Server
主要目的：基于缓存的加速。
副作用：还能有firewall功能，不过iptables也可以做到

nginx： 优势，使用了epoll， 在大并发下仍能有较高的吞吐率。
打开mode-proxy模块
ex:
location ~ \.*$ {
    proxy_pass  localhost:80;
    proxy_set_header X-Real-IP $remote_addr;   
}
通过["HTTP_X_REAL_IP"]访问。


Varnish：专一
要有缓存清除功能。

命中率
LRU： least recently used

问题：缓存空间，有效期，没被缓存的内容。

ESI： edge side include
    
首次加载： 别让一批用户来做，他们会抱怨的。自己写工具来预热。

第9章 Web组件分离

组件：
    动态内容/图片/CSS/js
因素：
    文件大小/数量/更新频率
    并发数/是否需要脚本解释器/RPC
    CPU密集/IO密集/DB访问瓶颈/
    read/write
    
组件分离提高了browser下载组件时的并发数。
http://site-perf.com

静态内容是IO密集型数据。






iptables -nL -t nat
